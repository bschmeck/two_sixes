<div>
  Waiting for game #<%= @game.id %> to begin.
</div>

<div>
  Players:<br>
  <ul data-bind="foreach: players">
    <li data-bind="text: handle"></li>
  </ul>
</div>

<div>
  Open Invites:<br>
  <ul data-bind="foreach: openInvites">
    <li><span data-bind="text: email" style="margin: 0 10px 0 0;"></span><!-- ko if: canRevoke -->(<a data-bind="attr: { href: revokeUrl }" data-method="post" rel="nofollow">Revoke</a>)<!-- /ko --></li>
  </ul>

  Declined Invites:<br>
  <ul data-bind="foreach: declinedInvites">
    <li><span data-bind="text: email" style="margin: 0 10px 0 0;"></span><!-- ko if: canRevoke -->(<a data-bind="attr: { href: revokeUrl }" data-method="post" rel="nofollow">Revoke</a>)<!-- /ko --></li>
  </ul>

  <% if @can_invite %>
    <%= form_for :invite, url: invite_game_path(@game) do |f| %>
      Email: <%= f.text_field :email %>
      <%= f.submit "Invite" %>
    <% end %>
  <% end %>
</div>

<% if @is_owner %>
  <div>
    <%= link_to "Start", start_game_path(@game), method: :post %>
  </div>
<% end %>

<% content_for :javascripts do %>
  <script type="text/javascript">
    var game = new GameViewModel();
    var canRevoke = <%= @can_revoke %>;

   <% @game.players.each do |player| %>
      game.addPlayer(new Player(-1, "<%= j player.handle %>", <%= player == @player %>));
   <% end %>

   <% @game.invites.open_or_declined.each do |invite| %>
      game.addInvite(new Invite(<%= raw invite.to_json %>));
    <% end %>

    ko.applyBindings(game);
  </script>
<% end %>
